# Cobra LANs

A cyberpunk-styled Windows desktop application for running LAN party game installations. Select one or more games from a YAML-driven manifest and install them all in one click — with file-integrity checking, version validation, and optional per-event game filtering baked in.

![Python](https://img.shields.io/badge/python-3.10%2B-blue)
![Platform](https://img.shields.io/badge/platform-Windows-lightgrey)
![License](https://img.shields.io/badge/license-see%20LICENSE-green)

---

## Features

- **Batch installation** — select any number of games and install them all to a chosen directory in one pass
- **Game & Server modes** — toggle between `GAME` and `SERVER` install modes; only entries of the matching type are shown
- **CRC32 integrity check** — performs a fast CRC32 hash check on the primary installer only (no slow full-file-list scan); the expected hash is stored in `games.yaml` and computed automatically by `update_manifest.py`
- **Disk-size display** — shows the size of each game's installer folder at a glance
- **Player name required** — a player name must be entered before any installation can proceed; it is passed to games that opt in via installer parameters at install time (command-line switches for Inno Setup, public properties for MSI)
- **YAML-driven manifest** — the game list lives in `config/games.yaml` outside the executable so it can be updated without a rebuild
- **Optional allow-list filter** — `config/filter.yaml` lets you restrict which games are shown; the list can auto-sync from the GitHub repository
- **Standalone executable** — ships as a single `.exe` built with PyInstaller
- **Automatic admin elevation** — the app requests administrator privileges on launch (required for MSI/EXE installers)

---

## Requirements

- Windows 10 / 11
- Python 3.10 or later (development only; end users run the pre-built `.exe`)
- Administrator privileges (the app auto-elevates on launch)
- Installer files placed under `Installers/<Game Name>/game/` (or `Game/`, case-insensitive) for game installers, and optionally `server/` (or `Server/`) for server installers

---

## Getting Started

### Running from source

1. **Clone the repository**

   ```bat
   git clone https://github.com/jamespwright/cobra-lans.git
   cd cobra-lans
   ```

2. **Install dependencies**

   ```bat
   pip install -r requirements.txt
   ```

3. **Place your installer files**

   Each game needs a subdirectory under `Installers/`:

   ```
   Installers/
   └── Battlefield 4/
       └── game/
           ├── Battlefield 4.exe
           └── Battlefield 4-1.bin
   ```

4. **Generate (or update) the game manifest**

   ```bat
   python scripts/update_manifest.py
   ```

   This scans `Installers/` and writes `config/games.yaml` automatically, preserving any manual fields you have already set.

5. **Launch the app**

   ```bat
   python cobra_lans.py
   ```

### Building a standalone executable

Run the included build script:

```bat
build.bat
```

The finished executable is placed at `dist\Cobra LANs.exe`. The script also copies `config\games.yaml` to `dist\config\games.yaml` so the manifest travels with the binary.

> **Note:** `build.bat` does not copy `config\filter.yaml`. If you need event-specific game filtering, copy it manually into `dist\config\filter.yaml`.

---

## Project Structure

```
cobra-lans/
├── cobra_lans.py            # Entry point
├── build.bat                # PyInstaller build script
├── requirements.txt
├── app/
│   ├── config.py            # Paths, colour palette, fonts
│   ├── data.py              # YAML loading, file verification, size helpers
│   ├── installer.py         # MSI/EXE installation logic (no UI dependencies)
│   ├── widgets.py           # Reusable Tkinter widgets (CyberButton, neon helpers)
│   └── window.py            # Main application window
├── config/
│   ├── games.yaml           # Game manifest (auto-generated by update_manifest.py)
│   └── filter.yaml          # Optional allow-list filter
├── scripts/
│   └── update_manifest.py   # Scans Installers/ and regenerates games.yaml
└── Installers/              # Installer files (not committed to git)
    └── <Game Name>/
        ├── game/            # Game installer files
        └── server/          # Server installer files (optional)
```

---

## Configuration

### `config/games.yaml`

The manifest is auto-generated by `scripts/update_manifest.py` but can also be edited by hand. Each entry supports these fields:

| Field | Type | Description |
|---|---|---|
| `name` | string | Display name |
| `type` | `game` \| `server` | Determines which install mode shows the entry |
| `installer_type` | `msi` \| `inno_setup` | Detected automatically |
| `base_path` | string | Path to the game folder relative to the project root |
| `version` | string | Display version (read from installer metadata) |
| `install_exe` | string | Primary EXE path relative to `base_path` (Inno Setup) |
| `install_msi` | string | Primary MSI path relative to `base_path` (MSI installers) |
| `crc32` | string | CRC32 hash of the primary installer (8-char uppercase hex) |
| `supports_player_name` | bool | Passes `PLAYERNAME` to the installer when `true` |
| `requires_server_ip` | bool | Prompts for a server IP and passes octets to the installer (MSI only) |
| `prerequisites` | list | Prerequisite installers to run before the main one |

Example:

```yaml
games:
  - name: Battlefield 4
    type: game
    installer_type: inno_setup
    base_path: Installers/Battlefield 4
    version: '1.0'
    install_exe: Game/Battlefield 4.exe
    crc32: 895A434B
    supports_player_name: false
    prerequisites: []
```

### `config/filter.yaml`

Restricts the displayed games to a named allow-list. When `sync_from_github: true`, the list is downloaded from the repository on each launch.

```yaml
enabled: true
sync_from_github: true
games:
  - Battlefield 4
```

Set `enabled: false` to show all games, or `sync_from_github: false` to manage the list locally.

---

## Deploying to a LAN event

1. Build the executable once with `build.bat`.
2. Copy the `dist\` folder to each LAN machine (or a shared network drive).
3. Ensure the `Installers\` tree is reachable from the same directory as the executable, **or** point the `base_path` entries in `games.yaml` to a UNC/network path.
4. *(Optional)* Copy `config\filter.yaml` into `dist\config\` and edit it to show only the games relevant to the event.
5. Run `Cobra LANs.exe` (the app will request administrator privileges automatically).

---

## Updating the manifest

After adding or removing installer files, regenerate the manifest from the project root:

```bat
python scripts/update_manifest.py
```

The script reads version metadata (MSI via COM object, EXE via PowerShell) and computes a **CRC32 hash** of the primary installer file, storing it as `crc32` in `games.yaml`. Only the primary installer is recorded — the old per-file `files` list is no longer used. Manual fields (`supports_player_name`, `requires_server_ip`, `prerequisites`) are preserved across runs.

---

## Contributing

1. Fork the repository and create a feature branch.
2. Keep UI logic in `app/window.py` and business logic in `app/data.py` / `app/installer.py`.
3. Run the app from source and confirm the change before opening a pull request.

Bug reports and pull requests are welcome on [GitHub](https://github.com/jamespwright/cobra-lans).

---

## License

See [LICENSE](LICENSE).
